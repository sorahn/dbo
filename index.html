<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Destiny Awaits</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css" rel="stylesheet">


  <!-- Le fav and touch icons -->
  <link rel="shortcut icon" href="http://twitter.github.com/bootstrap/assets/images/favicon.ico">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

  <link rel="stylesheet" type="text/css" href="http://localhost:8080/stylesheets/style.css">
  <base href="http://destiny.bungie.org/">

  <script id="article-template" type="text/x-handlebars-template">
    <article>
      <header>
        <h4>{{headline}}</h4>
      </header>

      {{{mobileBody}}}

      <footer class="clearfix">
        <small class="pull-right small">
          ({{poster}})
        </small>
      </footer>
    </article>
  </script>

</head>
<body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">

        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>

        <a class="brand" href="#" data-text='&nbsp;D路 B路 O'>&nbsp;D路 B路 O</a>

        <div class="nav-collapse">
          <ul class="nav">
            <li>
              <form class="navbar-search">
                <input type="text" class="search-query input-block-level" placeholder="Search The News Archive">
              </form>
            </li>
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Forum</a></li>
            <li class="divider-vertical divider-horizontal"></li>
          </ul>
        </div><!--/.nav-collapse -->

      </div>
    </div>
  </div>

  <div class="container">
    <section id="articles"></section>
    <footer>
      <p>&copy; Company 2012</p>
    </footer>
  </div> <!-- /container -->

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="//code.jquery.com/jquery.js"></script>
  <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0-rc.3/handlebars.min.js"></script>
  <script>
    $(function () {

      $('[href=#]').on('click', function (e) {
        e.preventDefault();
      });

      $('.btn').on('touchend', function (e) {
        $(this).trigger('click');
        e.preventDefault();
      })

      $('.nav-collapse').on('hide', function () {
        var $btn = $('.btn-navbar'),
            $parent = $btn.parent(),
            $next = $btn.next();

        $btn.detach().insertBefore($next).blur();
      })

      $.getJSON('http://localhost:3000/posts').done(onDone);

      setTimeout( hideAddressBar, 5);

      // Functions
      function onDone(data) {
        var template = Handlebars.compile( $('#article-template').html() ),
            $articles = $('#articles');

        $(data).each( function () {
          this.mobileBody = mobilizeContent(this);
          $articles.append( template(this) );
        });
      }

      function mobilizeContent( post ) {
        var $body = $('<div/>').html(post.body),

        // Lets make the images look a little nicer.
        $img = $body.find('img');
        $img.addClass('thumbnail');

        $iframe = $body.find('iframe');
        $iframe.prop('width', '100%').prop('height', '');

        var html = $body.html();
        return html;
      }

      function hideAddressBar() {
        $('body').css('paddingBottom', 5000);
        window.scrollTo(0, 1);
        setTimeout( function () {
          $('body').css('paddingBottom', 0);
        }, 50);
      }

    })
  </script>

  <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
</body>
</html>
